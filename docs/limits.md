# 系統限制與配額 (System Limits & Quotas)

本文件概述了系統關鍵部分的運行限制與配額。設定這些限制是為了確保系統的穩定性、效能、安全性和可預測的成本。所有開發人員在設計功能時都應考慮這些限制。

---

## 1. Firestore

- **文件最大寫入速率 (持續)**:
  - **限制**: 每個文件每秒 1 次。
  - **影響**: 頻繁更新單一文件（例如：計數器）的設計模式應被避免。應考慮使用分片計數器 (sharded counters) 等技術。

- **同時連線數**:
  - **限制**: 每個資料庫 1,000,000。
  - **影響**: 雖然上限很高，但應注意行動客戶端和長時間開啟的 Web 應用程式可能會快速消耗連線數。務必正確處理離線和重新連線。

- **文件大小**:
  - **限制**: 1 MiB (1,048,576 bytes)。
  - **影響**: 不應在單一文件中儲存大量非結構化數據或大型陣列。對於需要儲存的檔案，應使用 Cloud Storage，並在 Firestore 中只儲存其引用 URL。

- **索引條目大小**:
  - **限制**: 每個索引條目 7.5 KiB。
  - **影響**: 避免對超長字串欄位建立索引。

---

## 2. Cloud Storage

- **最大檔案大小**:
  - **限制**: 每個物件 5 TB。
  - **影響**: 對於大多數應用場景，此限制足夠。但對於超大檔案上傳，應考慮使用分片上傳 (multi-part uploads)。

- **每日上傳操作次數**:
  - **限制**: 無硬性限制，但受計費方案約束。
  - **影響**: 應監控上傳操作的數量以控制成本。對於使用者生成內容的應用，可能需要設定使用者級別的上傳頻率限制。

---

## 3. Authentication

- **帳戶創建速率**:
  - **限制**: 每個 IP 位址每小時 100 個帳戶。
  - **影響**: 防止暴力註冊攻擊。在需要大量自動化註冊的場景中（如測試），需要特殊處理。

- **電子郵件發送速率**:
  - **限制**: 有每日配額限制（具體取決於專案信譽）。
  - **影響**: 密碼重設、電子郵件驗證等功能的使用頻率受此限制。

---

## 4. Cloud Functions (Genkit Flows)

- **函數執行時間**:
  - **限制**: 預設 60 秒，最長可設定為 9 分鐘。
  - **影響**: 所有後端流程（Flows）的設計都必須考慮在此時間內完成。對於長時間運行的任務，應將其分解為多個步驟或使用非同步處理模式（如 Pub/Sub）。

- **記憶體分配**:
  - **限制**: 可在 128MB 到 8GB 之間設定。
  - **影響**: 處理大型檔案或複雜計算的流程需要足夠的記憶體。應根據實際需求進行配置，以平衡成本和效能。

---

## 5. 應用程式級別限制 (Application-Level Limits)

這些是由我們自身業務邏輯強制執行的限制，旨在確保系統的穩定和公平使用。

- **API 請求速率**:
  - **設計**: 應為每個使用者或 IP 設計一個合理的請求速率限制（例如：每分鐘 100 次請求）。
  - **實現**: 可透過 Cloud Functions 的中間件或 API Gateway 實現。

- **組織與工作區數量**:
  - **設計**: 每個使用者可創建的組織數量和每個組織可創建的工作區數量應有所限制，以防止資源濫用。
